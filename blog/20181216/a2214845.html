<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="技术、音乐、个人博客"><title>关于依赖注入(typescript) | Simple的个人博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">关于依赖注入(typescript)</h1><a id="logo" href="/.">Simple的个人博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">关于依赖注入(typescript)</h1><div class="post-meta">12/16/2018</div><div class="post-content"><h3 id="一、概念：依赖注入（DI）、控制反转（IOC）、IOC容器"><a href="#一、概念：依赖注入（DI）、控制反转（IOC）、IOC容器" class="headerlink" title="一、概念：依赖注入（DI）、控制反转（IOC）、IOC容器"></a>一、概念：依赖注入（DI）、控制反转（IOC）、IOC容器</h3><p>依赖注入（DI）和控制反转（IOC）基本是一个意思，因为说起来谁都离不开谁。<br>简单来说，类A依赖类B，但A不控制B的创建和销毁，仅使用B，那么B的控制权则交给A之外处理，这叫控制反转（IOC）。<br>由于A依赖于B，因此在A中必然要使用B的instance，我们可以通过A的构造函数将B的实例注入，比如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123; &#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(b: B) &#123; </span><br><span class="line">      <span class="built_in">console</span>.log(b);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> b = <span class="keyword">new</span> B();</span><br><span class="line"><span class="comment">// 将B的实例注入到a中</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> A(b);</span><br></pre></td></tr></table></figure></p>
<p>   这个过程叫依赖注入（DI）。<br>   那么什么是IOC Container（容器）？<br>在刚刚的例子中，将B的实例注入到A的构造函数中的这个过程是我们手动操作的，比较麻烦，特别是当类的关系变多变复杂时，这种方式显得很难维护。<br>因此IOC容器就是为了解决这样的问题，IOC容器负责管理对象的生命周期、依赖关系等，实现对象的依赖查找以及依赖注入。<br>   比如Java的Spring以及前端@Angular框架的依赖注入器（DI）就是属于IOC容器。</p>
<p>接下来我将通过代码的形式对比使用依赖注入相比非依赖注入的好处体现在哪。</p>
<h3 id="二、非依赖注入代码"><a href="#二、非依赖注入代码" class="headerlink" title="二、非依赖注入代码"></a>二、非依赖注入代码</h3><p>我们先来看一段传统的实现代码（非DI）<br>car.ts<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引擎 </span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Engine</span> </span>&#123;</span><br><span class="line">  public cylinders = <span class="string">'引擎发动机1'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 轮胎</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  public engine: Engine;</span><br><span class="line">  public tires: Tires;</span><br><span class="line">  public description = <span class="string">'No DI'</span>; </span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.engine = <span class="keyword">new</span> Engine();</span><br><span class="line">    <span class="keyword">this</span>.tires = <span class="keyword">new</span> Tires();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Method using the engine and tires</span></span><br><span class="line">  drive() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.description&#125;</span> car with `</span> +</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.engine.cylinders&#125;</span> cylinders and <span class="subst">$&#123;<span class="keyword">this</span>.tires.make&#125;</span> tires.`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>   在以上代码中，Car类没有通过第三方容器而是亲自创建了一个引擎（engine）和一些轮胎（tires），这样的代码耦合度比较高，这样会存在以下问题：</p>
<p>问题1：如果有一天对引擎进行升级，代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引擎  </span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Engine</span> </span>&#123;</span><br><span class="line">  public cylinders = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(_cylinders:string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.cylinders = _cylinders;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在创建引擎的时候需要传入一个参数，那么这时候就需要修改Car类里的new Engine(parameter)，这样就导致Car类被破坏了，这里请思考一个问题：要怎么做才能使引擎升级的时候不需要修改Car类呢？（答案：DI）</p>
<p>问题2：如果想在Car上使用不同品牌的轮胎，代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 轮胎</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires1</span> <span class="keyword">extends</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌1'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires2</span> <span class="keyword">extends</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌2'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">   <span class="comment">//。。。。。。其他代码省略。。。。。。。</span></span><br><span class="line">  public tires: Tires;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.tires = <span class="keyword">new</span> Tires1();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>此时又得重新修改Car的代码，这里请思考一个问题：要怎么做才能使Car更换其他不同品牌的轮胎的时候不需要修改Car类呢？（答案：DI）</p>
<p>问题3：如何实现数据共享，比如说车联网，建立了一个Service数据中心，不同的Car通过Service实现数据通信以及数据共享，如果是通过在Car里new Service的方式，是无法实现数据共享和通信的，因为不同Car里的Service不是同一个实例。</p>
<p>这里请思考一个问题：如何实现不同Car的数据通信和共享呢？</p>
<p>问题4：测试比较难，根本无法测试。<br>       在示例代码中，Car类依赖于Engine类和Tires类，而Engine和Tires又可能各自依赖于其他的类，而其他的类又可能有各自更多的依赖，在这样层层的依赖关系中，由于不能控制Car背后的隐藏依赖，要进行测试是比较难的，或者应该说，这样的代码是根本无法进行测试的。<br>比如说想同时测试不同品牌的轮子的car的性能，因为car里头的new已经写死了，因此无法做到。<br>比如说想同时测试不同参数的引擎的car的性能，因为car里头的new已经写死了，因此无法做到。<br>除非是每次只测试一种情况，下面拿测试不同品牌的轮子来举例：<br>先测试品牌1的轮子：<br>car.ts<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires1</span> <span class="keyword">extends</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌1'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires2</span> <span class="keyword">extends</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌2'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  public tires: Tires;</span><br><span class="line">  public description = <span class="string">'No DI'</span>; </span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// new 一个品牌1的轮子</span></span><br><span class="line">    <span class="keyword">this</span>.tires = <span class="keyword">new</span> Tires1();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Method using the engine and tires</span></span><br><span class="line">  drive() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.description&#125;</span> car with `</span> + <span class="string">` <span class="subst">$&#123;<span class="keyword">this</span>.tires.make&#125;</span> tires.`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试程序car.spec.ts</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Car &#125; <span class="keyword">from</span> <span class="string">'./car.ts'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Car类单元测试'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">'测试品牌1轮子的Car的驾驶性能'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> car = <span class="keyword">new</span> Car();</span><br><span class="line">    car.drive().should.equal(<span class="string">'No DI car with 品牌1 tires.'</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>以上代码对轮子品牌1进行测试，输出轮子品牌1的car的驾驶性能。<br>接着对轮子品牌2进行测试：修改Car类,将this.tires = new Tires1();修改为<br>this.tires = new Tires2();此时输出轮子品牌2的car的驾驶性能。</p>
<p>这样的测试效率是很低的，因为每次只能手动的测试一种情况，如果再加上引擎的测试，那多种混合情况就更多了，根本就不能做到自动测试，所谓的自动测试，是一次性将所有的情况都写到一个单元测试里，一次运行，所有情况都会被测试到，当测试通过了，那么就说明代码达到了预期。</p>
<p>针对以上问题，我们来看看使用DI的好处。</p>
<h3 id="三、使用依赖注入（DI）"><a href="#三、使用依赖注入（DI）" class="headerlink" title="三、使用依赖注入（DI）"></a>三、使用依赖注入（DI）</h3><p>接下来将演示使用DI来解决以上的4个问题。<br>先看使用DI实现的car.ts代码：<br>car.ts<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Engine</span> </span>&#123;</span><br><span class="line">  public cylinders = <span class="string">'引擎发动机1'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires1</span> <span class="keyword">extends</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌1'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires2</span> <span class="keyword">extends</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌2'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  public description = <span class="string">'DI'</span>; </span><br><span class="line">  <span class="comment">// 通过构造函数注入Engine和Tires</span></span><br><span class="line">  <span class="keyword">constructor</span>(public engine: Engine, public tires: Tires) &#123;&#125;  </span><br><span class="line">  <span class="comment">// Method using the engine and tires</span></span><br><span class="line">  drive() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.description&#125;</span> car with `</span> +</span><br><span class="line">      <span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.engine.cylinders&#125;</span> cylinders and <span class="subst">$&#123;<span class="keyword">this</span>.tires.make&#125;</span> tires.`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在以上代码中，通过往构造函数中传入engine和tires来创建Car，Car类不再亲自创建engine和tires，而是消费它们，此时最大的好处就是engine和tires与Car解除了强耦的关系。在new Car的时候，可以传入任何类型的Engine和Tires，即 let car = new Car(new Engine(),new Tires());</p>
<p>解决问题1：如果有一天对引擎进行升级，代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Engine</span> </span>&#123;</span><br><span class="line">  public cylinders = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">constructor</span>(_cylinders:string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.cylinders = _cylinders;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在创建引擎的时候需要传入一个参数，这时候不需要修改Car类，只需要修改主程序即可：</p>
<p>主程序代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">main()&#123;</span><br><span class="line">    <span class="keyword">const</span> car = <span class="keyword">new</span> Car(<span class="keyword">new</span> Engine(<span class="string">'引擎启动机2'</span>), <span class="keyword">new</span> Tires1());</span><br><span class="line">    car.drive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解决问题2：如果想在Car上使用不同品牌的轮胎，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tire1</span> <span class="keyword">extends</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌1'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Tire2</span> <span class="keyword">extends</span> <span class="title">Tires</span> </span>&#123;</span><br><span class="line">  public make = <span class="string">'品牌2'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">   <span class="comment">//。。。。。。其他代码省略。。。。。。。</span></span><br><span class="line">  <span class="keyword">constructor</span>(public engine: Engine, public tires: Tires) &#123;&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时不需要修改Car类，只需要修改主程序即可：<br>主程序代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">main()&#123;</span><br><span class="line">  <span class="comment">// 使用品牌2的轮胎</span></span><br><span class="line">  <span class="keyword">const</span> car = <span class="keyword">new</span> Car(<span class="keyword">new</span> Engine(<span class="string">'引擎启动机2'</span>), <span class="keyword">new</span> Tires2());</span><br><span class="line">  car.drive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>解决问题3：如何实现数据共享，比如说车联网，建立一个Service数据中心（就像angular的Service层，可以给多个component共享），不同的Car通过Service实现数据通信以及数据共享。<br>代码如下：<br>Service.ts<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">  public data = <span class="string">''</span>;</span><br><span class="line">  <span class="comment">// 向Service存数据</span></span><br><span class="line">  setData(_data: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.data = _data;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 从Service中取数据</span></span><br><span class="line">  getData() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.data;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>car.ts<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(public service: Service) &#123; &#125;</span><br><span class="line">  <span class="comment">// 向Service存数据</span></span><br><span class="line">  setDataToService(_data: string) &#123;</span><br><span class="line">    <span class="keyword">this</span>.service.setData(_data);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 从Service中取数据</span></span><br><span class="line">  getDataFromService() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.service.getData();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>此时主程序如下：<br>主程序代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">main()&#123;</span><br><span class="line">  <span class="comment">// 创建一个共享服务中心Service</span></span><br><span class="line">  <span class="keyword">const</span> shareService = <span class="keyword">new</span> Service();</span><br><span class="line">  <span class="keyword">const</span> car1 = <span class="keyword">new</span> Car(shareService);</span><br><span class="line">  <span class="keyword">const</span> car2 = <span class="keyword">new</span> Car(shareService);</span><br><span class="line">  <span class="comment">// car1向服务中心存数据</span></span><br><span class="line">  car1.setDataToService(<span class="string">'this data is from car1.'</span>);</span><br><span class="line">  <span class="comment">// car2从服务中心取数据</span></span><br><span class="line">  car2.getDataFromService();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>解决问题4：测试用例<br>    在示例代码中，Car类依赖于Engine类和Tires类，而Engine和Tires又可能各自依赖于其他的类，而其他的类又可能有各自的依赖，在这样层层的依赖关系中，使用DI的代码测试是比较简单的。<br>测试程序如下：<br>测试程序 car.spec.ts</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Car,Engine,Tires1, Tires2&#125; <span class="keyword">from</span> <span class="string">'./car.ts'</span>;</span><br><span class="line"><span class="comment">// 测试程序入口</span></span><br><span class="line">describe(<span class="string">'Car类单元测试'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> engine1 = <span class="keyword">new</span> Engine(<span class="string">'引擎发动机1'</span>);</span><br><span class="line">  <span class="keyword">const</span> engine2 = <span class="keyword">new</span> Engine(<span class="string">'引擎发动机2'</span>);</span><br><span class="line">  <span class="keyword">const</span> tires1 = <span class="keyword">new</span> Tires1();</span><br><span class="line">  <span class="keyword">const</span> tires2 = <span class="keyword">new</span> Tires2();</span><br><span class="line"></span><br><span class="line">  it(<span class="string">'测试引擎1 轮胎品牌1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> car = <span class="keyword">new</span> Car(engine1, tires1);</span><br><span class="line">    car.drive().should.equal(<span class="string">'DI car with 引擎发动机1 cylinders and 品牌1 tires.'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  it(<span class="string">'测试引擎1 轮胎品牌2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> car = <span class="keyword">new</span> Car(engine1, tires2);</span><br><span class="line">    car.drive().should.equal(<span class="string">'DI car with 引擎发动机1 cylinders and 品牌2 tires.'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  it(<span class="string">'测试引擎2 轮胎品牌1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> car = <span class="keyword">new</span> Car(engine2, tires1);</span><br><span class="line">    car.drive().should.equal(<span class="string">'DI car with 引擎发动机2 cylinders and 品牌1 tires.'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  it(<span class="string">'测试引擎2 轮胎品牌2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> car = <span class="keyword">new</span> Car(engine2, tires2);</span><br><span class="line">    car.drive().should.equal(<span class="string">'DI car with 引擎发动机2 cylinders and 品牌2 tires.'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时觉得很棒有木有，自动测试的思想就是这样的，将所有的情况的代码都配置好，一次运行，所有的情况都可以测试到。</p>
<p>至此，如果看懂以上的话，DI的思想以及为什么要用DI就应该可以理解了。</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/blog/20181223/e2c87752.html">@angular前端项目代码优化：构建Api Tree</a><a class="next" href="/blog/20181209/8d45a80b.html">如何解决前端跨域问题</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/20190224/e9584fe7.html">webpack4实践笔记(7):关于SplitChunksPlugin代码分离</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/20190224/4af33ce3.html">webpack4实践笔记(6):webpack + babel7 + typescript</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/20190224/808417d9.html">webpack4实践笔记(5):webpack + typescript</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/20190224/b77e298c.html">webpack4实践笔记(4):webpack + babel7</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/20190224/a9943a25.html">webpack4实践笔记(3):webpack默认支持各种模块化规范</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/20190224/9f220a6b.html">webpack4实践笔记(2):使用webpack.config.js配置文件</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/20190224/f0110ca0.html">webpack4实践笔记(1):最简单的webpack实例</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/20181223/e2c87752.html">@angular前端项目代码优化：构建Api Tree</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/20181216/a2214845.html">关于依赖注入(typescript)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/20181209/8d45a80b.html">如何解决前端跨域问题</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 技术博客</i></div><ul></ul><a href="https://www.jianshu.com/u/9be5a5a0beb9" title="简书" target="_blank">简书</a><ul></ul><a href="https://blog.csdn.net/simple__dream" title="csdn" target="_blank">csdn</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Simple的个人博客.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>